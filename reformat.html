<html>
  <head>
  </head>
  <body>
    <p>Drag this bookmark into your bookmark bar: <a id="bookmark">Formatter</a></p>
    <p>To use this, go to the site on songbase and click on the bookmark. Nothing will appear to happen however you will have copied the formatted song. Just paste normally by using ctrl-v and adjust line breaks if needed. <br><br><br>If you have any more questions or need to change the format of the text, email me at <a href="mailto:samuelminghuang@gmail.com">samuelminghuang@gmail.com</a></p>
    <script>
      document.getElementById("bookmark").href = `javascript:(function(){
const chordFont="7pt 'Arial Black', Gadget, sans-serif",textFont="10pt Georgia, serif",commentFont="10pt Arial, Helvetica, sans-serif",commentType="h3",commentColor="#434343",defaultColor="#000000",canvas=document.createElement("canvas"),context=canvas.getContext("2d");function calcWidth(e,t){return context.font=t?chordFont:textFont,context.measureText(e).width}let lyrics=song.props.lyrics,lines=lyrics.split("\\n");const storage=document.createElement("div");document.body.append(storage);for(let s=0;s<lines.length;s++){const d=document.createElement("div");d.style.whiteSpace="pre-wrap",d.style.color=defaultColor,d.innerText="";let e=/^([0-9]+)$/gm;if(e.test(lines[s])&&(d.innerText=lines[s]+"\\n",s++),"#"==lines[s][0]){const f=document.createElement(commentType);f.style.font=commentFont,f.style.color=commentColor,f.innerText="\\t"+lines[s].substring(1,lines[s].length),storage.append(f)}else{if(lines[s].includes("[")){const g=document.createElement("div");g.style.whiteSpace="pre-wrap",g.style.font=chordFont,g.style.color=defaultColor;let o="";for(let l=0;l<lines[s].length;l++)if(0==l&&"  "==lines[s].substr(0,2)&&(l=2),"["==lines[s][l]){l++;let t="";for(let e=l;e<lines[s].length;e++){if("]"==lines[s][e]){l=e;break}t+=lines[s][e]}let e=calcWidth(o,!1)-calcWidth(g.innerText,!0),n=Math.round(e/calcWidth(" ",!0));g.innerText+=" ".repeat(n)+t}else o+=lines[s][l];"  "==lines[s].substr(0,2)?g.innerText="\\t\\t"+g.innerText:g.innerText="\\t"+g.innerText,storage.append(g)}d.style.font=textFont,"  "==lines[s].substr(0,2)?d.innerText+="\\t\\t"+lines[s].substring(2,lines[s].length).replaceAll(/\\[.*?\\]/g,""):d.innerText+="\\t"+lines[s].replaceAll(/\\[.*?\\]/g,""),storage.append(d)}}var range=document.createRange();range.selectNode(storage),window.getSelection().removeAllRanges(),window.getSelection().addRange(range),document.execCommand("copy"),window.getSelection().removeAllRanges(),storage.remove();
      })();`;
      
      // To change JS bookmarklet, copy code from https://github.com/sensei-huang/hymn-research/blob/main/reformat.js
      // Minify using https://jscompress.com/
      // Replace '\' with '\\'. Note that you will have to replace with '\\\\' if you are replacing this in github
    </script>
  </body>
</html>
